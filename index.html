<!DOCTYPE html>
<html lang="en">
<!--
  TimeFlow - Beautiful Time Tracking Application
  Copyright (c) 2024 TimeFlow. All rights reserved.
  
  This source code is proprietary and confidential. Any unauthorized
  copying, modification, distribution, or use is strictly prohibited.
  
  For licensing inquiries: legal@timeflow.live
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeFlow - Beautiful Timer, Stopwatch & Pomodoro</title>
    <meta name="description" content="Free online timer, stopwatch, and Pomodoro timer with beautiful design and customizable sounds. Perfect for productivity, studying, and time tracking.">
    <meta name="keywords" content="timer, stopwatch, pomodoro, productivity, time tracking, online timer">
    <meta name="author" content="TimeFlow">
    <meta name="copyright" content="Copyright (c) 2024 TimeFlow. All rights reserved.">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4722603000032628"
     crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            overflow-x: hidden;
            overflow-y: auto;
            position: relative;
            padding: 20px 0;
        }
        
        /* When ads are visible, adjust body padding */
        body.ad-visible {
            padding-bottom: 120px;  /* Reduced to match smaller ad container */
        }

        /* Animated background particles */
        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
        }

        @keyframes floatUp {
            0% {
                opacity: 0;
                transform: translateY(0) translateX(0) scale(0);
            }
            10% {
                opacity: 1;
                transform: translateY(-20px) translateX(var(--drift)) scale(1);
            }
            90% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateY(-500px) translateX(calc(var(--drift) * 3)) scale(0.3);
            }
        }

        @keyframes floatSide {
            0% {
                opacity: 0;
                transform: translateX(0) translateY(0) scale(0);
            }
            10% {
                opacity: 1;
                transform: translateX(var(--driftX)) translateY(var(--driftY)) scale(1);
            }
            90% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateX(calc(var(--driftX) * 5)) translateY(calc(var(--driftY) * 5)) scale(0.3);
            }
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 500px;
            width: 90%;
            transform: translateY(0);
            transition: transform 0.3s ease;
        }

        .container:hover {
            transform: translateY(-5px);
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            opacity: 0.9;
            font-size: 1.1em;
        }

        .mode-switcher {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }

        .mode-btn {
            padding: 12px 30px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .mode-btn.active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
        }

        .display {
            font-size: 4em;
            text-align: center;
            margin: 40px 0;
            font-weight: 300;
            letter-spacing: 0.05em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }

        .display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        .timer-inputs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .timer-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .timer-input {
            width: 80px;
            padding: 15px;
            font-size: 24px;
            text-align: center;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .timer-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .timer-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .timer-label {
            margin-top: 8px;
            font-size: 14px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .control-btn:active::before {
            width: 300px;
            height: 300px;
        }

        .start-btn {
            background: #4ade80;
            color: #1a1a1a;
            box-shadow: 0 5px 15px rgba(74, 222, 128, 0.4);
        }

        .start-btn:hover {
            background: #22c55e;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(74, 222, 128, 0.5);
        }

        .pause-btn {
            background: #fbbf24;
            color: #1a1a1a;
            box-shadow: 0 5px 15px rgba(251, 191, 36, 0.4);
        }

        .pause-btn:hover {
            background: #f59e0b;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(251, 191, 36, 0.5);
        }

        .reset-btn {
            background: #ef4444;
            color: white;
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }

        .reset-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(239, 68, 68, 0.5);
        }

        .lap-btn {
            background: #8b5cf6;
            color: white;
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.4);
        }

        .lap-btn:hover {
            background: #7c3aed;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(139, 92, 246, 0.5);
        }

        .laps {
            margin-top: 30px;
            max-height: 200px;
            overflow-y: auto;
            padding: 0 10px;
        }

        .lap-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .hidden {
            display: none;
        }

        /* Responsive design */
        @media (max-width: 600px) {
            .container {
                padding: 25px;
                width: 95%;
            }
            
            .display {
                font-size: 3em;
                padding: 15px;
            }
            
            .timer-input {
                width: 60px;
                font-size: 20px;
                padding: 12px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .subtitle {
                font-size: 1em;
            }
            
            .mode-btn {
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .control-btn {
                padding: 12px 30px;
                font-size: 16px;
                min-width: 100px;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            
            .timer-inputs {
                gap: 10px;
            }
            
            .controls {
                gap: 10px;
            }
        }
        
        /* Very small screens */
        @media (max-width: 380px) {
            .container {
                padding: 20px;
            }
            
            .display {
                font-size: 2.5em;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .mode-btn {
                padding: 8px 16px;
                font-size: 13px;
            }
            
            .control-btn {
                padding: 10px 25px;
                font-size: 14px;
            }
            
            .timer-input {
                width: 50px;
                font-size: 18px;
            }
        }

        /* Custom scrollbar */
        .laps::-webkit-scrollbar {
            width: 8px;
        }

        .laps::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .laps::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        .laps::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Pomodoro styles */
        .pomodoro-status {
            text-align: center;
            margin-bottom: 30px;
        }

        .pomodoro-info {
            margin-bottom: 15px;
        }

        .pomodoro-info span {
            display: block;
            margin: 5px 0;
        }

        #pomodoroPhase {
            font-size: 1.5em;
            font-weight: 600;
            color: #fbbf24;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        #pomodoroCount {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .pomodoro-dots {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .dot.active {
            background: #fbbf24;
            transform: scale(1.3);
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        .dot.completed {
            background: #4ade80;
        }

        .skip-btn {
            background: #6366f1;
            color: white;
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
        }

        .skip-btn:hover {
            background: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(99, 102, 241, 0.5);
        }

        /* Settings styles */
        .settings-btn {
            margin-top: 15px;
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Pomodoro settings moved to main settings modal */

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .setting-item label {
            font-size: 14px;
            opacity: 0.9;
        }

        .setting-item input {
            padding: 10px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 16px;
            width: 80px;
            text-align: center;
        }

        .setting-item input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
        }

        .setting-unit {
            font-size: 12px;
            opacity: 0.7;
        }

        .save-settings-btn {
            width: 100%;
            padding: 12px;
            background: #4ade80;
            color: #1a1a1a;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-settings-btn:hover {
            background: #22c55e;
            transform: translateY(-2px);
        }

        /* Main Settings Button */
        .main-settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .main-settings-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Main Settings Modal */
        .main-settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            padding: 20px;
        }

        .main-settings-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .main-settings-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .main-settings-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .main-settings-header h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .settings-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .settings-section h3 {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #fbbf24;
        }

        .sound-options {
            display: grid;
            gap: 15px;
        }

        .sound-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .sound-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .sound-option.selected {
            background: rgba(74, 222, 128, 0.2);
            border: 1px solid rgba(74, 222, 128, 0.5);
        }

        .sound-option input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #4ade80;
        }

        .sound-info {
            flex: 1;
        }

        .sound-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .sound-description {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .preview-btn {
            padding: 8px 20px;
            background: rgba(139, 92, 246, 0.3);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .preview-btn:hover {
            background: rgba(139, 92, 246, 0.5);
            transform: scale(1.05);
        }


        .close-main-settings {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 24px;
        }

        .close-main-settings:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1) rotate(90deg);
        }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            padding: 20px;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 400px;
            width: 100%;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-content {
            text-align: center;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 15px;
            color: white;
        }

        .modal-message {
            font-size: 1.1em;
            margin-bottom: 25px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .modal-btn-confirm {
            background: #4ade80;
            color: #1a1a1a;
            box-shadow: 0 5px 15px rgba(74, 222, 128, 0.4);
        }

        .modal-btn-confirm:hover {
            background: #22c55e;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(74, 222, 128, 0.5);
        }

        .modal-btn-cancel {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-btn-cancel:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Ad Container Styles */
        .ad-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 110px;  /* 90px ad + 20px padding */
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .ad-container.hidden {
            transform: translateY(100%);
        }

        .ad-wrapper {
            max-width: 728px;
            width: 100%;
            text-align: center;
            position: relative;
            padding-top: 20px;  /* Space for the label */
        }

        .ad-label {
            position: absolute;
            top: 5px;  /* Position inside the container */
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
            z-index: 1;
        }



        /* Responsive ad adjustments */
        /* iPad and tablets */
        @media (max-width: 1024px) and (min-width: 768px) {
            .ad-container {
                padding: 10px;
                min-height: 110px;  /* 90px ad + 20px padding */
            }
            
            body.ad-visible {
                padding-bottom: 120px;
            }
            
            .ad-wrapper {
                max-width: 728px;
            }
        }
        
        /* Small tablets and large phones */
        @media (max-width: 767px) {
            .ad-container {
                padding: 8px;
                min-height: 66px;  /* 50px ad + 16px padding */
            }
            
            body.ad-visible {
                padding-bottom: 80px;
            }
            
            .ad-wrapper {
                max-width: 320px;
            }
        }
        
        /* Mobile phones */
        @media (max-width: 480px) {
            .ad-container {
                padding: 8px;
                min-height: 66px;  /* 50px ad + 16px padding */
            }
            
            body.ad-visible {
                padding-bottom: 80px;
            }
            
            .ad-wrapper {
                max-width: 320px;
            }
            
            
            .main-settings-content {
                padding: 30px;
            }
            
            .main-settings-header h2 {
                font-size: 1.5em;
            }
            
            .settings-section {
                padding: 20px;
            }
            
            .sound-option {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .preview-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Animated particles -->
    <div id="particles"></div>

    <!-- Custom Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-content">
                <h2 class="modal-title" id="modalTitle">Confirmation</h2>
                <p class="modal-message" id="modalMessage">Are you sure?</p>
                <div class="modal-buttons" id="modalButtons">
                    <button class="modal-btn modal-btn-cancel" onclick="closeModal(false)">Cancel</button>
                    <button class="modal-btn modal-btn-confirm" onclick="closeModal(true)">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Settings Modal -->
    <div class="main-settings-modal" id="mainSettingsModal">
        <div class="main-settings-content">
            <button class="close-main-settings" onclick="toggleMainSettings()">×</button>
            
            <div class="main-settings-header">
                <h2>Settings</h2>
                <p class="subtitle">Customize your TimeFlow experience</p>
            </div>

            <div class="settings-section">
                <h3>🍅 Pomodoro Settings</h3>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label>Work Duration</label>
                        <input type="number" id="mainWorkDuration" value="25" min="1" max="60" onchange="markMainSettingsChanged()">
                        <span class="setting-unit">minutes</span>
                    </div>
                    <div class="setting-item">
                        <label>Short Break</label>
                        <input type="number" id="mainShortBreak" value="5" min="1" max="30" onchange="markMainSettingsChanged()">
                        <span class="setting-unit">minutes</span>
                    </div>
                    <div class="setting-item">
                        <label>Long Break</label>
                        <input type="number" id="mainLongBreak" value="15" min="1" max="60" onchange="markMainSettingsChanged()">
                        <span class="setting-unit">minutes</span>
                    </div>
                    <div class="setting-item">
                        <label>Sessions Until Long Break</label>
                        <input type="number" id="mainSessionsUntilLong" value="4" min="2" max="10" onchange="markMainSettingsChanged()">
                        <span class="setting-unit">sessions</span>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>⏰ Timer Sound</h3>
                <div class="sound-options">
                    <label class="sound-option">
                        <input type="radio" name="timerSound" value="sine" checked>
                        <div class="sound-info">
                            <div class="sound-name">Gentle Chime</div>
                            <div class="sound-description">Soft, pleasant tone perfect for focus work</div>
                        </div>
                        <button class="preview-btn" onclick="previewSound('sine')">Preview</button>
                    </label>

                    <label class="sound-option">
                        <input type="radio" name="timerSound" value="square">
                        <div class="sound-info">
                            <div class="sound-name">Digital Beep</div>
                            <div class="sound-description">Clear, attention-grabbing alert</div>
                        </div>
                        <button class="preview-btn" onclick="previewSound('square')">Preview</button>
                    </label>

                    <label class="sound-option">
                        <input type="radio" name="timerSound" value="triangle">
                        <div class="sound-info">
                            <div class="sound-name">Soft Bell</div>
                            <div class="sound-description">Warm, friendly notification</div>
                        </div>
                        <button class="preview-btn" onclick="previewSound('triangle')">Preview</button>
                    </label>

                    <label class="sound-option">
                        <input type="radio" name="timerSound" value="chime">
                        <div class="sound-info">
                            <div class="sound-name">Wind Chime</div>
                            <div class="sound-description">Musical sequence with three ascending notes</div>
                        </div>
                        <button class="preview-btn" onclick="previewSound('chime')">Preview</button>
                    </label>

                    <label class="sound-option">
                        <input type="radio" name="timerSound" value="bell">
                        <div class="sound-info">
                            <div class="sound-name">Church Bell</div>
                            <div class="sound-description">Deep, resonant bell tone</div>
                        </div>
                        <button class="preview-btn" onclick="previewSound('bell')">Preview</button>
                    </label>

                    <label class="sound-option">
                        <input type="radio" name="timerSound" value="none">
                        <div class="sound-info">
                            <div class="sound-name">Silent</div>
                            <div class="sound-description">No sound (visual notification only)</div>
                        </div>
                        <button class="preview-btn" disabled style="opacity: 0.5;">Preview</button>
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3>🔊 Volume</h3>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <input type="range" id="volumeSlider" min="0" max="100" value="30" 
                           style="flex: 1; accent-color: #4ade80; height: 6px; cursor: pointer;">
                    <span id="volumeValue" style="min-width: 50px; text-align: right; font-weight: 600;">30%</span>
                </div>
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <button class="save-settings-btn" onclick="saveAllSettings()" style="padding: 12px 30px; font-size: 16px;">
                    Save All Settings
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <h1>TimeFlow</h1>
        <p class="subtitle">Beautiful Time Tracking</p>
        
        <!-- Main Settings Button -->
        <button class="main-settings-btn" onclick="toggleMainSettings()" title="Settings">
            ⚙️
        </button>

        <div class="mode-switcher">
            <button class="mode-btn active" onclick="switchMode('timer')">Timer</button>
            <button class="mode-btn" onclick="switchMode('stopwatch')">Stopwatch</button>
            <button class="mode-btn" onclick="switchMode('pomodoro')">Pomodoro</button>
        </div>

        <div class="display" id="display">00:00:00</div>

        <!-- Pomodoro status -->
        <div class="pomodoro-status hidden" id="pomodoroStatus">
            <div class="pomodoro-info">
                <span id="pomodoroPhase">Work Session</span>
                <span id="pomodoroCount">1 of 4</span>
            </div>
            <div class="pomodoro-dots">
                <span class="dot active"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
        </div>

        <!-- Pomodoro Settings Panel Removed - Now in Main Settings -->
        <div class="pomodoro-settings hidden" id="pomodoroSettings" style="display: none !important;">
            <h3>Pomodoro Settings</h3>
            <div class="settings-grid">
                <div class="setting-item">
                    <label>Work Duration</label>
                    <input type="number" id="workDuration" value="25" min="1" max="60" onchange="markPomodoroSettingsChanged()">
                    <span class="setting-unit">minutes</span>
                </div>
                <div class="setting-item">
                    <label>Short Break</label>
                    <input type="number" id="shortBreakDuration" value="5" min="1" max="30" onchange="markPomodoroSettingsChanged()">
                    <span class="setting-unit">minutes</span>
                </div>
                <div class="setting-item">
                    <label>Long Break</label>
                    <input type="number" id="longBreakDuration" value="15" min="1" max="60" onchange="markPomodoroSettingsChanged()">
                    <span class="setting-unit">minutes</span>
                </div>
                <div class="setting-item">
                    <label>Sessions until Long Break</label>
                    <input type="number" id="sessionsUntilLong" value="4" min="2" max="10" onchange="markPomodoroSettingsChanged()">
                    <span class="setting-unit">sessions</span>
                </div>
            </div>
            <button class="save-settings-btn" onclick="savePomodoroSettings()">Save Settings</button>
        </div>

        <!-- Timer inputs -->
        <div class="timer-inputs" id="timerInputs">
            <div class="timer-input-group">
                <input type="number" class="timer-input" id="hoursInput" placeholder="00" min="0" max="99">
                <span class="timer-label">Hours</span>
            </div>
            <div class="timer-input-group">
                <input type="number" class="timer-input" id="minutesInput" placeholder="00" min="0" max="59">
                <span class="timer-label">Minutes</span>
            </div>
            <div class="timer-input-group">
                <input type="number" class="timer-input" id="secondsInput" placeholder="00" min="0" max="59">
                <span class="timer-label">Seconds</span>
            </div>
        </div>

        <div class="controls">
            <button class="control-btn start-btn" id="startBtn" onclick="start()">Start</button>
            <button class="control-btn pause-btn hidden" id="pauseBtn" onclick="pause()">Pause</button>
            <button class="control-btn reset-btn" onclick="reset()">Reset</button>
            <button class="control-btn lap-btn hidden" id="lapBtn" onclick="lap()">Lap</button>
            <button class="control-btn skip-btn hidden" id="skipBtn" onclick="skipPomodoro()">Skip</button>
        </div>

        <div class="laps hidden" id="laps"></div>
    </div>

    <!-- Ad Container -->
    <div class="ad-container" id="adContainer">
        <div class="ad-wrapper">
            <span class="ad-label">Advertisement</span>
            <!-- AdSense Ad Unit -->
            <ins class="adsbygoogle"
                 style="display:inline-block;width:728px;height:90px"
                 data-ad-client="ca-pub-4722603000032628"
                 data-ad-slot="1234567890"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>


    <script>
        // TimeFlow Timer Application
        // Copyright (c) 2024 TimeFlow. All rights reserved.
        
        // Console copyright warning
        console.log('%c⚠️ STOP! TimeFlow Timer - Proprietary Software', 'color: red; font-size: 30px; font-weight: bold;');
        console.log('%cThis is a browser feature intended for developers. If someone told you to copy-paste something here, it is likely a scam.', 'color: red; font-size: 16px;');
        console.log('%cCopyright (c) 2024 TimeFlow. All rights reserved.', 'color: red; font-weight: bold;');
        console.log('%cUnauthorized access, modification, or distribution is prohibited.', 'color: red;');
        
        // Domain restriction and anti-theft protection
        (function() {
            const allowedDomains = [
                'timeflow.live',
                'www.timeflow.live',
                'localhost',
                '127.0.0.1',
                '0.0.0.0',
                'github.io',  // For GitHub Pages testing
                'githubusercontent.com'  // For GitHub raw view
            ];
            
            const currentDomain = window.location.hostname;
            
            // Allow file:// protocol for local development
            const isFileProtocol = window.location.protocol === 'file:';
            const isLocalIP = /^192\.168\.|^10\.|^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(currentDomain);
            const isAllowed = isFileProtocol || isLocalIP || 
                allowedDomains.some(domain => 
                    currentDomain === domain || currentDomain.endsWith('.' + domain)
                );
            
            if (!isAllowed) {
                document.body.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                        color: white;
                        text-align: center;
                        padding: 20px;
                    ">
                        <div style="
                            background: rgba(255, 255, 255, 0.1);
                            backdrop-filter: blur(10px);
                            border-radius: 20px;
                            padding: 40px;
                            max-width: 500px;
                            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
                        ">
                            <h1 style="font-size: 3em; margin-bottom: 20px;">🚫</h1>
                            <h2 style="font-size: 2em; margin-bottom: 20px;">Unauthorized Access</h2>
                            <p style="font-size: 1.2em; margin-bottom: 30px;">
                                This application is protected by copyright law and is being used without authorization.
                            </p>
                            <p style="font-size: 1em; opacity: 0.8; margin-bottom: 20px;">
                                The genuine TimeFlow Timer is available at:
                            </p>
                            <a href="https://timeflow.live" style="
                                display: inline-block;
                                padding: 15px 30px;
                                background: rgba(74, 222, 128, 0.3);
                                color: white;
                                text-decoration: none;
                                border-radius: 50px;
                                font-size: 1.1em;
                                transition: all 0.3s ease;
                            ">Visit Official TimeFlow</a>
                            <p style="font-size: 0.9em; margin-top: 30px; opacity: 0.7;">
                                Legal inquiries: legal@timeflow.live
                            </p>
                        </div>
                    </div>
                `;
                
                // Log unauthorized access attempt
                console.error('Unauthorized domain access:', currentDomain);
                
                // Stop all timer functionality
                return;
            }
        })();
        
        let mode = 'timer';
        let interval = null;
        let time = 0;
        let isRunning = false;
        let laps = [];
        let modalCallback = null;
        
        // Pomodoro variables
        let pomodoroPhase = 'work'; // 'work', 'shortBreak', 'longBreak'
        let pomodoroCount = 1;
        let completedPomodoros = 0;
        let sessionsUntilLongBreak = 4;
        let POMODORO_TIMES = {
            work: 25 * 60,        // 25 minutes default
            shortBreak: 5 * 60,   // 5 minutes default
            longBreak: 15 * 60    // 15 minutes default
        };
        let pomodoroSettingsChanged = false;
        
        // Sound settings
        let selectedSound = 'sine';
        let soundVolume = 0.3;

        // Load saved settings if they exist
        function loadPomodoroSettings() {
            const saved = localStorage.getItem('pomodoroSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                POMODORO_TIMES.work = settings.work * 60;
                POMODORO_TIMES.shortBreak = settings.shortBreak * 60;
                POMODORO_TIMES.longBreak = settings.longBreak * 60;
                sessionsUntilLongBreak = settings.sessionsUntilLong;
                
                // Update input values
                document.getElementById('workDuration').value = settings.work;
                document.getElementById('shortBreakDuration').value = settings.shortBreak;
                document.getElementById('longBreakDuration').value = settings.longBreak;
                document.getElementById('sessionsUntilLong').value = settings.sessionsUntilLong;
            }
        }

        // Save settings
        function savePomodoroSettings() {
            const work = parseInt(document.getElementById('workDuration').value);
            const shortBreak = parseInt(document.getElementById('shortBreakDuration').value);
            const longBreak = parseInt(document.getElementById('longBreakDuration').value);
            const sessions = parseInt(document.getElementById('sessionsUntilLong').value);
            
            const settings = {
                work: work,
                shortBreak: shortBreak,
                longBreak: longBreak,
                sessionsUntilLong: sessions
            };
            
            // Note: localStorage won't work in Claude artifacts, but would work in production
            try {
                localStorage.setItem('pomodoroSettings', JSON.stringify(settings));
            } catch (e) {
                // Ignore localStorage errors in artifact environment
            }
            
            POMODORO_TIMES.work = work * 60;
            POMODORO_TIMES.shortBreak = shortBreak * 60;
            POMODORO_TIMES.longBreak = longBreak * 60;
            sessionsUntilLongBreak = sessions;
            
            // Update dots if sessions changed
            updatePomodoroDots();
            
            // Reset timer with new settings if in pomodoro mode
            if (mode === 'pomodoro' && !isRunning) {
                time = POMODORO_TIMES[pomodoroPhase];
                updateDisplay();
            }
            
            // Reset change flag
            pomodoroSettingsChanged = false;
            
            // Hide settings
            document.getElementById('pomodoroSettings').classList.add('hidden');
            
            // Show generic success message
            customAlert('Settings saved successfully!');
        }

        // Deprecated - Pomodoro settings now in main settings
        function togglePomodoroSettings() {
            // Open main settings instead
            toggleMainSettings();
        }
        
        // Track settings changes
        function markPomodoroSettingsChanged() {
            pomodoroSettingsChanged = true;
        }
        
        // Check for unsaved changes and handle them
        async function checkAndHandleUnsavedSettings() {
            const settings = document.getElementById('pomodoroSettings');
            
            // If settings are not open or no changes, return true to continue
            if (settings.classList.contains('hidden') || !pomodoroSettingsChanged) {
                return true;
            }
            
            // Show confirmation dialog
            const shouldSave = await customConfirm('You have unsaved settings. Would you like to save them before continuing?');
            
            if (shouldSave === null || shouldSave === false) {
                // User cancelled - keep settings open and don't proceed with action
                return false;
            }
            
            // User confirmed - save settings and close panel
            savePomodoroSettings();
            settings.classList.add('hidden');
            pomodoroSettingsChanged = false;
            
            return true;
        }

        function updatePomodoroDots() {
            const dotsContainer = document.querySelector('.pomodoro-dots');
            dotsContainer.innerHTML = '';
            
            for (let i = 0; i < sessionsUntilLongBreak; i++) {
                const dot = document.createElement('span');
                dot.className = 'dot';
                if (i < completedPomodoros) {
                    dot.classList.add('completed');
                } else if (i === completedPomodoros && pomodoroPhase === 'work') {
                    dot.classList.add('active');
                }
                dotsContainer.appendChild(dot);
            }
        }

        // Create floating particles around the container
        function createParticles() {
            const container = document.querySelector('.container');
            const particlesContainer = document.getElementById('particles');
            
            // Create particles that emit from the container edges
            setInterval(() => {
                if (document.querySelectorAll('.particle').length < 30) {
                    createParticle();
                }
            }, 300);
        }

        function createParticle() {
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            const container = document.querySelector('.container');
            const rect = container.getBoundingClientRect();
            
            // Randomly choose which edge to emit from
            const edge = Math.floor(Math.random() * 4);
            let startX, startY;
            
            switch(edge) {
                case 0: // Top edge
                    startX = rect.left + Math.random() * rect.width;
                    startY = rect.top;
                    particle.style.setProperty('--drift', (Math.random() - 0.5) * 100 + 'px');
                    particle.style.animation = 'floatUp 6s ease-out forwards';
                    break;
                case 1: // Right edge
                    startX = rect.right;
                    startY = rect.top + Math.random() * rect.height;
                    particle.style.setProperty('--driftX', Math.random() * 100 + 50 + 'px');
                    particle.style.setProperty('--driftY', (Math.random() - 0.5) * 200 + 'px');
                    particle.style.animation = 'floatSide 6s ease-out forwards';
                    break;
                case 2: // Bottom edge
                    startX = rect.left + Math.random() * rect.width;
                    startY = rect.bottom;
                    particle.style.setProperty('--drift', (Math.random() - 0.5) * 100 + 'px');
                    particle.style.animation = 'floatUp 6s ease-out forwards';
                    break;
                case 3: // Left edge
                    startX = rect.left;
                    startY = rect.top + Math.random() * rect.height;
                    particle.style.setProperty('--driftX', Math.random() * -100 - 50 + 'px');
                    particle.style.setProperty('--driftY', (Math.random() - 0.5) * 200 + 'px');
                    particle.style.animation = 'floatSide 6s ease-out forwards';
                    break;
            }
            
            particle.style.left = startX + 'px';
            particle.style.top = startY + 'px';
            
            document.getElementById('particles').appendChild(particle);
            
            // Remove particle after animation
            particle.addEventListener('animationend', () => {
                particle.remove();
            });
        }

        // Initialize particles after a short delay to ensure container is rendered
        setTimeout(createParticles, 100);
        
        // Load saved Pomodoro settings on startup
        loadPomodoroSettings();
        
        // New function to load Pomodoro settings into main settings modal
        function loadPomodoroSettingsToMain() {
            document.getElementById('mainWorkDuration').value = Math.round(POMODORO_TIMES.work / 60);
            document.getElementById('mainShortBreak').value = Math.round(POMODORO_TIMES.shortBreak / 60);
            document.getElementById('mainLongBreak').value = Math.round(POMODORO_TIMES.longBreak / 60);
            document.getElementById('mainSessionsUntilLong').value = sessionsUntilLongBreak;
        }
        
        // Save Pomodoro settings from main settings modal
        function savePomodoroSettingsFromMain() {
            const work = parseInt(document.getElementById('mainWorkDuration').value);
            const shortBreak = parseInt(document.getElementById('mainShortBreak').value);
            const longBreak = parseInt(document.getElementById('mainLongBreak').value);
            const sessions = parseInt(document.getElementById('mainSessionsUntilLong').value);
            
            // Validation
            if (work < 1 || work > 60 || shortBreak < 1 || shortBreak > 30 || 
                longBreak < 1 || longBreak > 60 || sessions < 2 || sessions > 10) {
                customAlert('Please enter valid values for all settings.');
                return;
            }
            
            // Save to localStorage
            const settings = {
                work: work,
                shortBreak: shortBreak,
                longBreak: longBreak,
                sessionsUntilLong: sessions
            };
            
            try {
                localStorage.setItem('pomodoroSettings', JSON.stringify(settings));
            } catch (e) {
                // Ignore localStorage errors
            }
            
            // Update the global values
            POMODORO_TIMES.work = work * 60;
            POMODORO_TIMES.shortBreak = shortBreak * 60;
            POMODORO_TIMES.longBreak = longBreak * 60;
            sessionsUntilLongBreak = sessions;
            
            // If in Pomodoro mode and timer is stopped, update the display
            if (mode === 'pomodoro' && !isRunning) {
                time = POMODORO_TIMES[pomodoroPhase];
                updateDisplay();
            }
            
            // Success message shown by saveAllSettings
        }
        
        // Track changes in main settings
        let mainSettingsChanged = false;
        
        function markMainSettingsChanged() {
            mainSettingsChanged = true;
        }
        
        // Save all settings from the main settings modal
        function saveAllSettings() {
            // Save Pomodoro settings
            savePomodoroSettingsFromMain();
            
            // Sound settings are saved automatically on change
            
            // Show generic success message
            customAlert('Settings saved successfully!');
            
            // Close the modal
            setTimeout(() => {
                document.getElementById('mainSettingsModal').classList.remove('active');
            }, 1500);
        }
        
        // Ad management
        function initAds() {
            const adContainer = document.getElementById('adContainer');
            
            // Always show ads
            adContainer.classList.remove('hidden');
            document.body.classList.add('ad-visible');
            
            // Clear any old preferences
            localStorage.removeItem('adsHidden');
            
            // Load responsive ad
            updateAdSize();
        }
        
        
        function updateAdSize() {
            const adUnit = document.querySelector('.adsbygoogle');
            if (!adUnit) return;
            
            const width = window.innerWidth;
            
            if (width < 768) {
                // Mobile banner (320x50) - standard mobile size
                adUnit.style.width = '320px';
                adUnit.style.height = '50px';
            } else {
                // Desktop leaderboard (728x90) - standard desktop size
                adUnit.style.width = '728px';
                adUnit.style.height = '90px';
            }
        }
        
        // Initialize ads on load
        window.addEventListener('load', initAds);
        window.addEventListener('resize', updateAdSize);
        
        // Main Settings Functions
        function toggleMainSettings() {
            const modal = document.getElementById('mainSettingsModal');
            modal.classList.toggle('active');
            
            if (modal.classList.contains('active')) {
                loadSoundSettings();
                loadPomodoroSettingsToMain();
            }
        }

        function loadSoundSettings() {
            // Load saved sound settings
            const savedSound = localStorage.getItem('selectedSound');
            const savedVolume = localStorage.getItem('soundVolume');
            
            if (savedSound) {
                selectedSound = savedSound;
                document.querySelector(`input[name="timerSound"][value="${savedSound}"]`).checked = true;
            }
            
            if (savedVolume) {
                soundVolume = parseFloat(savedVolume);
                document.getElementById('volumeSlider').value = soundVolume * 100;
                document.getElementById('volumeValue').textContent = Math.round(soundVolume * 100) + '%';
            }
            
            // Update selected styling
            updateSoundOptionStyling();
        }

        function updateSoundOptionStyling() {
            document.querySelectorAll('.sound-option').forEach(option => {
                const radio = option.querySelector('input[type="radio"]');
                if (radio.checked) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        // Save sound selection
        document.addEventListener('change', function(e) {
            if (e.target.name === 'timerSound') {
                selectedSound = e.target.value;
                localStorage.setItem('selectedSound', selectedSound);
                updateSoundOptionStyling();
            }
        });

        // Volume control
        document.addEventListener('DOMContentLoaded', function() {
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeValue = document.getElementById('volumeValue');
            
            volumeSlider.addEventListener('input', function() {
                soundVolume = this.value / 100;
                volumeValue.textContent = this.value + '%';
                localStorage.setItem('soundVolume', soundVolume);
            });
            
            // Load saved settings on startup
            loadSoundSettings();
        });
        
        // Custom modal functions
        function showModal(title, message, isConfirm = false) {
            return new Promise((resolve) => {
                const modal = document.getElementById('modalOverlay');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');
                const modalButtons = document.getElementById('modalButtons');
                
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                
                if (isConfirm) {
                    modalButtons.innerHTML = `
                        <button class="modal-btn modal-btn-cancel" onclick="closeModal(false)">Cancel</button>
                        <button class="modal-btn modal-btn-confirm" onclick="closeModal(true)">Confirm</button>
                    `;
                } else {
                    modalButtons.innerHTML = `
                        <button class="modal-btn modal-btn-confirm" onclick="closeModal(true)">OK</button>
                    `;
                }
                
                modalCallback = resolve;
                modal.classList.add('active');
            });
        }
        
        function closeModal(result) {
            const modal = document.getElementById('modalOverlay');
            modal.classList.remove('active');
            
            if (modalCallback) {
                modalCallback(result);
                modalCallback = null;
            }
        }
        
        // Override alert and confirm
        window.customAlert = function(message) {
            return showModal('Notice', message, false);
        };
        
        window.customConfirm = function(message) {
            return showModal('Confirmation', message, true);
        };

        function switchMode(newMode) {
            mode = newMode;
            reset();
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const timerInputs = document.getElementById('timerInputs');
            const lapBtn = document.getElementById('lapBtn');
            const lapsContainer = document.getElementById('laps');
            const pomodoroStatus = document.getElementById('pomodoroStatus');
            const skipBtn = document.getElementById('skipBtn');
            const pomodoroSettings = document.getElementById('pomodoroSettings');

            // Always hide pomodoro settings when switching modes
            pomodoroSettings.classList.add('hidden');

            if (mode === 'timer') {
                timerInputs.classList.remove('hidden');
                lapBtn.classList.add('hidden');
                lapsContainer.classList.add('hidden');
                pomodoroStatus.classList.add('hidden');
                skipBtn.classList.add('hidden');
            } else if (mode === 'stopwatch') {
                timerInputs.classList.add('hidden');
                lapBtn.classList.remove('hidden');
                pomodoroStatus.classList.add('hidden');
                skipBtn.classList.add('hidden');
            } else if (mode === 'pomodoro') {
                timerInputs.classList.add('hidden');
                lapBtn.classList.add('hidden');
                lapsContainer.classList.add('hidden');
                pomodoroStatus.classList.remove('hidden');
                skipBtn.classList.remove('hidden');
                initPomodoro();
            }
        }

        function formatTime(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateDisplay() {
            document.getElementById('display').textContent = formatTime(time);
        }

        async function start() {
            // Handle unsaved Pomodoro settings
            if (mode === 'pomodoro') {
                const shouldContinue = await checkAndHandleUnsavedSettings();
                if (!shouldContinue) return;
            }
            
            if (mode === 'timer' && time === 0) {
                const hours = parseInt(document.getElementById('hoursInput').value) || 0;
                const minutes = parseInt(document.getElementById('minutesInput').value) || 0;
                const seconds = parseInt(document.getElementById('secondsInput').value) || 0;
                
                time = hours * 3600 + minutes * 60 + seconds;
                
                if (time === 0) {
                    customAlert('Please set a time first!');
                    return;
                }
            } else if (mode === 'pomodoro' && time === 0) {
                time = POMODORO_TIMES[pomodoroPhase];
            }

            isRunning = true;
            document.getElementById('startBtn').classList.add('hidden');
            document.getElementById('pauseBtn').classList.remove('hidden');
            
            if (mode === 'stopwatch') {
                document.getElementById('lapBtn').classList.remove('hidden');
            }

            interval = setInterval(() => {
                if (mode === 'timer' || mode === 'pomodoro') {
                    time--;
                    if (time <= 0) {
                        time = 0;
                        pause();
                        playSound();
                        
                        if (mode === 'pomodoro') {
                            handlePomodoroComplete();
                        } else {
                            customAlert('Time\'s up!');
                        }
                    }
                } else {
                    time++;
                }
                updateDisplay();
            }, 1000);
        }

        async function pause() {
            // Handle unsaved Pomodoro settings
            if (mode === 'pomodoro') {
                const shouldContinue = await checkAndHandleUnsavedSettings();
                if (!shouldContinue) return;
            }
            
            isRunning = false;
            clearInterval(interval);
            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');
        }

        async function reset() {
            // Handle unsaved Pomodoro settings
            if (mode === 'pomodoro') {
                const shouldContinue = await checkAndHandleUnsavedSettings();
                if (!shouldContinue) return;
            }
            
            pause();
            time = 0;
            laps = [];
            updateDisplay();
            
            document.getElementById('hoursInput').value = '';
            document.getElementById('minutesInput').value = '';
            document.getElementById('secondsInput').value = '';
            document.getElementById('laps').innerHTML = '';
            document.getElementById('laps').classList.add('hidden');
            
            if (mode === 'pomodoro') {
                initPomodoro();
            }
        }

        function initPomodoro() {
            pomodoroPhase = 'work';
            pomodoroCount = 1;
            completedPomodoros = 0;
            time = POMODORO_TIMES.work;
            updateDisplay();
            updatePomodoroStatus();
        }

        function updatePomodoroStatus() {
            const phaseText = pomodoroPhase === 'work' ? 'Work Session' : 
                             pomodoroPhase === 'shortBreak' ? 'Short Break' : 'Long Break';
            
            document.getElementById('pomodoroPhase').textContent = phaseText;
            document.getElementById('pomodoroCount').textContent = 
                pomodoroPhase === 'work' ? `${pomodoroCount} of ${sessionsUntilLongBreak}` : 'Break Time';
            
            // Update dots
            updatePomodoroDots();
            
            // Update phase color
            const phaseElement = document.getElementById('pomodoroPhase');
            if (pomodoroPhase === 'work') {
                phaseElement.style.color = '#fbbf24';
            } else if (pomodoroPhase === 'shortBreak') {
                phaseElement.style.color = '#4ade80';
            } else {
                phaseElement.style.color = '#8b5cf6';
            }
        }

        function handlePomodoroComplete() {
            if (pomodoroPhase === 'work') {
                completedPomodoros++;
                if (completedPomodoros >= sessionsUntilLongBreak) {
                    pomodoroPhase = 'longBreak';
                    customAlert('Great job! Time for a long break!');
                } else {
                    pomodoroPhase = 'shortBreak';
                    customAlert('Work session complete! Time for a short break.');
                }
                pomodoroCount = completedPomodoros + 1;
            } else if (pomodoroPhase === 'shortBreak') {
                pomodoroPhase = 'work';
                customAlert('Break over! Let\'s get back to work.');
            } else if (pomodoroPhase === 'longBreak') {
                completedPomodoros = 0;
                pomodoroCount = 1;
                pomodoroPhase = 'work';
                customAlert('Long break over! Starting a new cycle.');
            }
            
            time = POMODORO_TIMES[pomodoroPhase];
            updateDisplay();
            updatePomodoroStatus();
        }

        async function skipPomodoro() {
            // Handle unsaved settings first
            const shouldContinue = await checkAndHandleUnsavedSettings();
            if (!shouldContinue) return;
            
            if (await customConfirm('Are you sure you want to skip this session?')) {
                time = 0;
                pause();
                handlePomodoroComplete();
            }
        }

        function lap() {
            laps.push(time);
            const lapsContainer = document.getElementById('laps');
            lapsContainer.classList.remove('hidden');
            
            const lapItem = document.createElement('div');
            lapItem.className = 'lap-item';
            lapItem.innerHTML = `
                <span>Lap ${laps.length}</span>
                <span>${formatTime(time)}</span>
            `;
            
            lapsContainer.insertBefore(lapItem, lapsContainer.firstChild);
        }

        // Sound System
        function createAudioContext() {
            return new (window.AudioContext || window.webkitAudioContext)();
        }

        function playBasicTone(frequency, duration, type = 'sine', volume = soundVolume) {
            const audioContext = createAudioContext();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(volume, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function playChimeSequence(volume = soundVolume) {
            const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
            notes.forEach((freq, index) => {
                setTimeout(() => {
                    playBasicTone(freq, 0.8, 'sine', volume);
                }, index * 300);
            });
        }

        function playBellSound(volume = soundVolume) {
            const audioContext = createAudioContext();
            const fundamental = 200;
            const partials = [1, 2, 2.4, 3, 4.2]; // Bell harmonics
            
            partials.forEach((partial, index) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(fundamental * partial, audioContext.currentTime);
                oscillator.type = 'sine';
                
                const partialVolume = volume * (1 / (index + 1));
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(partialVolume, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 2);
            });
        }

        function playSound() {
            if (selectedSound === 'none') return;
            
            switch(selectedSound) {
                case 'sine':
                    playBasicTone(880, 1, 'sine');
                    break;
                case 'square':
                    playBasicTone(800, 0.2, 'square');
                    setTimeout(() => playBasicTone(800, 0.2, 'square'), 300);
                    break;
                case 'triangle':
                    playBasicTone(600, 0.8, 'triangle');
                    break;
                case 'chime':
                    playChimeSequence();
                    break;
                case 'bell':
                    playBellSound();
                    break;
            }
        }

        function previewSound(soundType) {
            event.preventDefault();
            event.stopPropagation();
            
            const originalSound = selectedSound;
            selectedSound = soundType;
            playSound();
            selectedSound = originalSound;
        }

        // Input validation
        document.getElementById('minutesInput').addEventListener('input', function(e) {
            if (e.target.value > 59) e.target.value = 59;
            if (e.target.value < 0) e.target.value = 0;
        });

        document.getElementById('secondsInput').addEventListener('input', function(e) {
            if (e.target.value > 59) e.target.value = 59;
            if (e.target.value < 0) e.target.value = 0;
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Block common developer tools shortcuts
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'C' || e.key === 'J')) ||
                (e.ctrlKey && e.key === 'U')) {
                e.preventDefault();
                customAlert('Developer tools are disabled for security reasons.');
                return false;
            }
            
            // Normal keyboard shortcuts
            if (e.code === 'Space') {
                e.preventDefault();
                if (isRunning) {
                    pause();
                } else {
                    start();
                }
            } else if (e.code === 'KeyR') {
                reset();
            } else if (e.code === 'KeyL' && mode === 'stopwatch' && isRunning) {
                lap();
            }
        });
        
        // Disable right-click context menu
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        
        // Disable text selection on timer display
        document.getElementById('display').style.userSelect = 'none';
        document.getElementById('display').style.webkitUserSelect = 'none';
    </script>

    <!-- Minimal Legal Footer -->
    <div style="position: fixed; bottom: 5px; right: 10px; font-size: 10px; opacity: 0.3; color: rgba(255, 255, 255, 0.6); z-index: 10;">
        © 2024 TimeFlow • <a href="terms.html" style="color: rgba(255, 255, 255, 0.6); text-decoration: none;">Terms</a> • <a href="privacy.html" style="color: rgba(255, 255, 255, 0.6); text-decoration: none;">Privacy</a>
    </div>
</body>
</html>